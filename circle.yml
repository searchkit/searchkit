general:
  branches:
    ignore:
      - gh-pages

machine:
  environment:
    PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"

  node:
    version: 8.6.0

general:
  artifacts:
    - packages/searchkit/coverage
    - packages/searchkit/lib
    - packages/searchkit/release
    - packages/searchkit-e2e-tests/cypress/video
    - packages/searchkit-e2e-tests/cypress/screenshots    

dependencies:
  pre: 
    - echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" >> ~/.npmrc

deployment:
  beta:
    tag: /^v\d+\.\d+\.\d+\-\d+$/
    commands:
      - npm publish --tag beta
  # beta:
  #   tag: /^v\d+\.\d+\.\d+\+$/
  #   commands:
  #     - npm publish
  #     - gitbook stuff


test:
  override:
    - (cd ./packages/searchkit && npm run build && npm run test:ci)
    - (cd ./packages/searchkit-e2e-tests && npm run build && npm run test:ci)
  post:
    - cat ./coverage/lcov.info | coveralls
    - cp packages/searchkit-e2e-tests/e2e-results.xml $CIRCLE_TEST_REPORTS/cypress
    - cp packages/searchkit/unit-results.xml $CIRCLE_TEST_REPORTS/jest
  pre:    
    - mkdir -p $CIRCLE_TEST_REPORTS/{jest,cypress}
    - npm install lerna -g
    - lerna bootstrap
